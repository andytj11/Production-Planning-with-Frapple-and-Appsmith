UPDATE public.operationplan
SET
    startdate = COALESCE(
                  NULLIF('{{ Plan_Table.updatedRow.startdate }}','')::timestamptz,
                  startdate),

    enddate   = COALESCE(
                  NULLIF('{{ Plan_Table.updatedRow.enddate }}','')::timestamptz,
                  enddate),

    /* quantity: only cast when not blank, match column type (integer) */
    quantity  = CASE
                  WHEN '{{ Plan_Table.updatedRow.quantity }}' = ''
                  THEN quantity                          -- leave old value
                  ELSE '{{ Plan_Table.updatedRow.quantity }}'::integer
                END,

    status    = COALESCE(
                  NULLIF('{{ Plan_Table.updatedRow.status }}','')::text,
                  status)

WHERE reference = '{{ Plan_Table.updatedRow.order_ref }}';
