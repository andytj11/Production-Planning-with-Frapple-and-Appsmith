SELECT
    COUNT(*)                                             AS total_completed,
    SUM(
        CASE
            WHEN d.delay <= INTERVAL '0 days' THEN 1     -- on-time or early
            ELSE 0
        END
    )                                                    AS on_time,
    ROUND(
        100.0
        * SUM(CASE WHEN d.delay <= INTERVAL '0 days' THEN 1 ELSE 0 END)
        / NULLIF(COUNT(*),0)
    , 1)                                                 AS perf_pct          -- e.g. 20.0
FROM   public.demand d
WHERE  d.status = 'closed'               -- completed
  AND  d.due    < CURRENT_DATE           -- end date before today
  AND  d.delay  IS NOT NULL;             -- safety guard
